# Pianoteq Volume Compensator

[![Rust](https://img.shields.io/badge/Built%20with-Rust-brown)](https://www.rust-lang.org)
[![Latest Release](https://img.shields.io/badge/Latest%20Release-0.1.0-brightgreen)](https://github.com/GarthTB/pianoteq-volume-compensator/releases)
[![License](https://img.shields.io/badge/License-Apache%202.0-royalblue)](https://www.apache.org/licenses/LICENSE-2.0)

## Introduction

**Pianoteq Volume Compensator** is a Rust application
that generates a set of volume compensation values
for Pianoteq, using a wav file as input, which is
generated by Pianoteq with a frequency-weeping MIDI file.
The application takes the input wav file, splits it into 88 slices,
calculates the rms amplitude of each slice, and generates
volume compensation values with moving average smoothing.
The volume compensation values are then saved to a text file
and a binary file. *The binary file can be copied and directly
replace a specific section of the Pianoteq preset file.*

*Not implemented yet*

## Usage

To use the application, make sure Pianoteq is installed on your system.
You also need to have a Pianoteq preset file that you want to
apply the volume compensation to. The preset file should be
in the format of a.fxp file. This application has been tested on
Windows 11 and Pianoteq 6.

1. Open Pianoteq and choose the preset file you want to modify.
2. Load the frequency-weeping MIDI file into Pianoteq.
3. Generate a wav file using the 'input.mid' file. (Must be wav format)
4. Close Pianoteq.
5. Configure the output file name, slice time, and smoothing factor in the config.toml file.
6. Run the application.
7. The application will generate a text file and a binary file.
8. Copy the binary file and paste it into the Pianoteq preset file, replacing the existing volume compensation section. (The section typically appears in the second block after the file header.)

## Configuration

The application uses a configuration file called `config.toml`.
The file contains the following options:

1. **input_file**: The name of the input wav file. (Must be in the same directory as the executable)
2. **output_bin**: The name of the output binary file. (Will be saved in the same directory as the executable. Will be overwritten if it already exists.)
3. **output_txt**: The name of the output text file. (Must be in the same directory as the executable. Will be overwritten if it already exists.)
4. **start_time**: The start time of the frequency-weeping wav file in seconds.
5. **end_time**: The end time of the frequency-weeping wav file in seconds.
6. **smooth_span**: The number of adjacent notes on either side of the current note to include in the smoothing calculation.

## License

This project is licensed under the Apache 2.0 license.

## Changelog

### v0.1.0 - 20250509

- Initial release.
